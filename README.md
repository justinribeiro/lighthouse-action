# Lighthouse with WPT Network Emulation Profiles, Github Action Edition

> Audit deployed web sites with my artisanal blend of WPT Network Emulation Profiles, Puppeteer, Chrome headless, Lighthouse, and Github Actions.

## Features

- Uses [Puppeteer](https://github.com/GoogleChrome/puppeteer) to start up Chrome with [network emulation settings defined by WebPageTest](https://github.com/WPO-Foundation/webpagetest/blob/master/www/settings/connectivity.ini.sample).
- Allows saving of artifacts to the Github Action run.
- Posts results of audit run as a comment on your PR.
  ![image](https://user-images.githubusercontent.com/643503/68066171-d35dc800-fcf0-11e9-9c95-72b689fa7eef.png)

## Usage

This is best run against `on: [pull_request]`, so you'll get the report comment, but you technically do not have to use it this way.

```yml
name: Audit Web Performance
on: [pull_request]
jobs:
  perf:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Generate Lighthouse Report
        uses: justinribeiro/lighthouse-action@master
        with:
          secret: ${{ secrets.GITHUB_TOKEN }}
          url: https://${{ github.sha }}-dot-${{ secrets.GAE_PID }}.appspot.com
          wptConnectionSpeed: threegfast
      - name: Saving Lighthouse Audit Artifacts
        uses: actions/upload-artifact@master
        with:
          name: lighthouse-artifacts
          path: './results'
```

## Inputs

### `secret`

**Required** This is the default secret for your repo as generated by Github Actions. Use the `${{ secrets.GITHUB_TOKEN }}` for this to allow commenting on your PRs.

### `url`

**Required** The URL you'd like Lighthouse to audit.

### `wptConnectionSpeed`

**Required** Profiles based on [WebPageTest project connectivity samples](https://github.com/WPO-Foundation/webpagetest/blob/master/www/settings/connectivity.ini.sample), defined in [chrome.js](https://github.com/justinribeiro/lighthouse-action/blob/master/src/chrome.js).

Defaults to `threegfast`. Can be any of the following: `twog`, `threegslow`, `threeg`, `threegfast`, `fourg`, `lte`.

## Outputs

### `resultsPath`

Path to the folder with Lighthouse audit results.

## Why I built this

1. I wanted a simpler, cleaner example anyone could jump into, fork, and make their own.
2. None of the other offerings post on a PR the audit result.
3. I wanted to explore harsher network conditioning.

## The future

1. Add fail case configuration
2. Add server warming flags (which I've found skews scores on a lot of deployments)
3. Add multi-url auditing
